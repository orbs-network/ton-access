"use strict";(()=>{var A=(r,n)=>()=>(n||r((n={exports:{}}).exports,n),n.exports);var M=A((j,V)=>{(function(r,n){typeof j=="object"&&typeof V!="undefined"?n(j):typeof define=="function"&&define.amd?define(["exports"],n):n(r.WHATWGFetch={})})(j,function(r){"use strict";var n=typeof globalThis!="undefined"&&globalThis||typeof self!="undefined"&&self||typeof n!="undefined"&&n,i={searchParams:"URLSearchParams"in n,iterable:"Symbol"in n&&"iterator"in Symbol,blob:"FileReader"in n&&"Blob"in n&&function(){try{return new Blob,!0}catch(t){return!1}}(),formData:"FormData"in n,arrayBuffer:"ArrayBuffer"in n};function o(t){return t&&DataView.prototype.isPrototypeOf(t)}if(i.arrayBuffer)var h=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],d=ArrayBuffer.isView||function(t){return t&&h.indexOf(Object.prototype.toString.call(t))>-1};function p(t){if(typeof t!="string"&&(t=String(t)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(t)||t==="")throw new TypeError('Invalid character in header field name: "'+t+'"');return t.toLowerCase()}function v(t){return typeof t!="string"&&(t=String(t)),t}function b(t){var e={next:function(){var s=t.shift();return{done:s===void 0,value:s}}};return i.iterable&&(e[Symbol.iterator]=function(){return e}),e}function a(t){this.map={},t instanceof a?t.forEach(function(e,s){this.append(s,e)},this):Array.isArray(t)?t.forEach(function(e){this.append(e[0],e[1])},this):t&&Object.getOwnPropertyNames(t).forEach(function(e){this.append(e,t[e])},this)}a.prototype.append=function(t,e){t=p(t),e=v(e);var s=this.map[t];this.map[t]=s?s+", "+e:e},a.prototype.delete=function(t){delete this.map[p(t)]},a.prototype.get=function(t){return t=p(t),this.has(t)?this.map[t]:null},a.prototype.has=function(t){return this.map.hasOwnProperty(p(t))},a.prototype.set=function(t,e){this.map[p(t)]=v(e)},a.prototype.forEach=function(t,e){for(var s in this.map)this.map.hasOwnProperty(s)&&t.call(e,this.map[s],s,this)},a.prototype.keys=function(){var t=[];return this.forEach(function(e,s){t.push(s)}),b(t)},a.prototype.values=function(){var t=[];return this.forEach(function(e){t.push(e)}),b(t)},a.prototype.entries=function(){var t=[];return this.forEach(function(e,s){t.push([s,e])}),b(t)},i.iterable&&(a.prototype[Symbol.iterator]=a.prototype.entries);function c(t){if(t.bodyUsed)return Promise.reject(new TypeError("Already read"));t.bodyUsed=!0}function g(t){return new Promise(function(e,s){t.onload=function(){e(t.result)},t.onerror=function(){s(t.error)}})}function W(t){var e=new FileReader,s=g(e);return e.readAsArrayBuffer(t),s}function G(t){var e=new FileReader,s=g(e);return e.readAsText(t),s}function z(t){for(var e=new Uint8Array(t),s=new Array(e.length),f=0;f<e.length;f++)s[f]=String.fromCharCode(e[f]);return s.join("")}function U(t){if(t.slice)return t.slice(0);var e=new Uint8Array(t.byteLength);return e.set(new Uint8Array(t)),e.buffer}function k(){return this.bodyUsed=!1,this._initBody=function(t){this.bodyUsed=this.bodyUsed,this._bodyInit=t,t?typeof t=="string"?this._bodyText=t:i.blob&&Blob.prototype.isPrototypeOf(t)?this._bodyBlob=t:i.formData&&FormData.prototype.isPrototypeOf(t)?this._bodyFormData=t:i.searchParams&&URLSearchParams.prototype.isPrototypeOf(t)?this._bodyText=t.toString():i.arrayBuffer&&i.blob&&o(t)?(this._bodyArrayBuffer=U(t.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):i.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(t)||d(t))?this._bodyArrayBuffer=U(t):this._bodyText=t=Object.prototype.toString.call(t):this._bodyText="",this.headers.get("content-type")||(typeof t=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):i.searchParams&&URLSearchParams.prototype.isPrototypeOf(t)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},i.blob&&(this.blob=function(){var t=c(this);if(t)return t;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){if(this._bodyArrayBuffer){var t=c(this);return t||(ArrayBuffer.isView(this._bodyArrayBuffer)?Promise.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):Promise.resolve(this._bodyArrayBuffer))}else return this.blob().then(W)}),this.text=function(){var t=c(this);if(t)return t;if(this._bodyBlob)return G(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(z(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},i.formData&&(this.formData=function(){return this.text().then(K)}),this.json=function(){return this.text().then(JSON.parse)},this}var X=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function J(t){var e=t.toUpperCase();return X.indexOf(e)>-1?e:t}function E(t,e){if(!(this instanceof E))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');e=e||{};var s=e.body;if(t instanceof E){if(t.bodyUsed)throw new TypeError("Already read");this.url=t.url,this.credentials=t.credentials,e.headers||(this.headers=new a(t.headers)),this.method=t.method,this.mode=t.mode,this.signal=t.signal,!s&&t._bodyInit!=null&&(s=t._bodyInit,t.bodyUsed=!0)}else this.url=String(t);if(this.credentials=e.credentials||this.credentials||"same-origin",(e.headers||!this.headers)&&(this.headers=new a(e.headers)),this.method=J(e.method||this.method||"GET"),this.mode=e.mode||this.mode||null,this.signal=e.signal||this.signal,this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&s)throw new TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(s),(this.method==="GET"||this.method==="HEAD")&&(e.cache==="no-store"||e.cache==="no-cache")){var f=/([?&])_=[^&]*/;if(f.test(this.url))this.url=this.url.replace(f,"$1_="+new Date().getTime());else{var l=/\?/;this.url+=(l.test(this.url)?"&":"?")+"_="+new Date().getTime()}}}E.prototype.clone=function(){return new E(this,{body:this._bodyInit})};function K(t){var e=new FormData;return t.trim().split("&").forEach(function(s){if(s){var f=s.split("="),l=f.shift().replace(/\+/g," "),u=f.join("=").replace(/\+/g," ");e.append(decodeURIComponent(l),decodeURIComponent(u))}}),e}function Q(t){var e=new a,s=t.replace(/\r?\n[\t ]+/g," ");return s.split("\r").map(function(f){return f.indexOf(`
`)===0?f.substr(1,f.length):f}).forEach(function(f){var l=f.split(":"),u=l.shift().trim();if(u){var B=l.join(":").trim();e.append(u,B)}}),e}k.call(E.prototype);function w(t,e){if(!(this instanceof w))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');e||(e={}),this.type="default",this.status=e.status===void 0?200:e.status,this.ok=this.status>=200&&this.status<300,this.statusText=e.statusText===void 0?"":""+e.statusText,this.headers=new a(e.headers),this.url=e.url||"",this._initBody(t)}k.call(w.prototype),w.prototype.clone=function(){return new w(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new a(this.headers),url:this.url})},w.error=function(){var t=new w(null,{status:0,statusText:""});return t.type="error",t};var Y=[301,302,303,307,308];w.redirect=function(t,e){if(Y.indexOf(e)===-1)throw new RangeError("Invalid status code");return new w(null,{status:e,headers:{location:t}})},r.DOMException=n.DOMException;try{new r.DOMException}catch(t){r.DOMException=function(e,s){this.message=e,this.name=s;var f=Error(e);this.stack=f.stack},r.DOMException.prototype=Object.create(Error.prototype),r.DOMException.prototype.constructor=r.DOMException}function H(t,e){return new Promise(function(s,f){var l=new E(t,e);if(l.signal&&l.signal.aborted)return f(new r.DOMException("Aborted","AbortError"));var u=new XMLHttpRequest;function B(){u.abort()}u.onload=function(){var m={status:u.status,statusText:u.statusText,headers:Q(u.getAllResponseHeaders()||"")};m.url="responseURL"in u?u.responseURL:m.headers.get("X-Request-URL");var O="response"in u?u.response:u.responseText;setTimeout(function(){s(new w(O,m))},0)},u.onerror=function(){setTimeout(function(){f(new TypeError("Network request failed"))},0)},u.ontimeout=function(){setTimeout(function(){f(new TypeError("Network request failed"))},0)},u.onabort=function(){setTimeout(function(){f(new r.DOMException("Aborted","AbortError"))},0)};function Z(m){try{return m===""&&n.location.href?n.location.href:m}catch(O){return m}}u.open(l.method,Z(l.url),!0),l.credentials==="include"?u.withCredentials=!0:l.credentials==="omit"&&(u.withCredentials=!1),"responseType"in u&&(i.blob?u.responseType="blob":i.arrayBuffer&&l.headers.get("Content-Type")&&l.headers.get("Content-Type").indexOf("application/octet-stream")!==-1&&(u.responseType="arraybuffer")),e&&typeof e.headers=="object"&&!(e.headers instanceof a)?Object.getOwnPropertyNames(e.headers).forEach(function(m){u.setRequestHeader(m,v(e.headers[m]))}):l.headers.forEach(function(m,O){u.setRequestHeader(O,m)}),l.signal&&(l.signal.addEventListener("abort",B),u.onreadystatechange=function(){u.readyState===4&&l.signal.removeEventListener("abort",B)}),u.send(typeof l._bodyInit=="undefined"?null:l._bodyInit)})}H.polyfill=!0,n.fetch||(n.fetch=H,n.Headers=a,n.Request=E,n.Response=w),r.Headers=a,r.Request=E,r.Response=w,r.fetch=H,Object.defineProperty(r,"__esModule",{value:!0})})});var F=A((ut,I)=>{M();I.exports=self.fetch.bind(self)});var S=A(T=>{"use strict";var tt=T&&T.__awaiter||function(r,n,i,o){function h(d){return d instanceof i?d:new i(function(p){p(d)})}return new(i||(i=Promise))(function(d,p){function v(c){try{a(o.next(c))}catch(g){p(g)}}function b(c){try{a(o.throw(c))}catch(g){p(g)}}function a(c){c.done?d(c.value):h(c.value).then(v,b)}a((o=o.apply(r,n||[])).next())})};Object.defineProperty(T,"__esModule",{value:!0});T.Nodes=void 0;F();var P=class{constructor(){this.nodeIndex=-1,this.committee=new Set,this.topology=[],this.initTime=0}init(n){return tt(this,void 0,void 0,function*(){this.nodeIndex=-1,this.committee.clear(),this.topology=[],this.initTime=Date.now();let i=[];try{i=yield(yield fetch(n)).json()}catch(o){throw new Error(`exception in fetch(${n}): ${o}`)}for(let o of i)o.Healthy==="1"&&this.topology.push(o);if(this.topology.length===0)throw new Error(`no healthy nodes in ${n}`)})}getHealthyFor(n){var i;let o=[];for(let h of this.topology)h.Weight>0&&((i=h.Mngr)===null||i===void 0?void 0:i.health[n])&&o.push(h);return o}};T.Nodes=P});var q=A((dt,et)=>{et.exports={name:"@orbs-network/ton-access",version:"2.3.3",description:"Unthrottled anonymous RPC access to TON blockchain via a robust decentralized network",source:"lib/index.js",main:"lib/index.js",types:"lib/index.d.ts",files:["lib/**/*"],scripts:{test:"env mocha -r ts-node/register test/**/*.ts","test:v2":"env mocha -r ts-node/register test/ton-v2.ts","test:v4":"env mocha -r ts-node/register test/ton-v4.ts",cleanup:"rimraf ./lib","build:web:reg":"esbuild ./lib/web.js --bundle  --sourcemap --target=es2015 --outfile=./dist/index.js","build:web:min":"esbuild ./lib/web.js --bundle  --minify    --target=es2015 --outfile=./dist/index.min.js","build:web":"rimraf ./dist && npm run build:web:reg && npm run build:web:min",build:"npm run lint && rimraf ./lib && tsc && npm run build:web",format:'prettier --write "src/**/*.ts"',lint:"tslint -p tsconfig.json",prepare:"npm run build",prepublishOnly:"npm test && npm run lint",preversion:"npm run lint",version:"npm run format && git add -A src",postversion:"git push && git push --tags"},repository:{type:"git",url:"git+https://github.com/orbs-network/ton-access.git"},author:"yuval@orbs.com",license:"MIT",bugs:{url:"https://github.com/orbs-network/ton-access/issues"},homepage:"https://github.com/orbs-network/ton-access#readme",dependencies:{"isomorphic-fetch":"^3.0.0"},devDependencies:{"@types/bn.js":"^5.1.1","@types/chai":"^4.3.4","@types/isomorphic-fetch":"^0.0.36","@types/mocha":"^10.0.0","@types/ws":"^8.5.4",buffer:"^6.0.3",chai:"^4.3.7",esbuild:"^0.15.14",mocha:"^10.1.0",prettier:"^2.7.1",rimraf:"^3.0.2",ton:"^12.1.3","ton-lite-client":"npm:@truecarry/ton-lite-client@^1.6.1",tonweb:"^0.0.58","ts-node":"^10.9.1",tslib:"^2.4.0",tslint:"^6.1.3","tslint-config-prettier":"^1.18.0",ws:"^8.13.0"}}});var L=A(y=>{"use strict";var _=y&&y.__awaiter||function(r,n,i,o){function h(d){return d instanceof i?d:new i(function(p){p(d)})}return new(i||(i=Promise))(function(d,p){function v(c){try{a(o.next(c))}catch(g){p(g)}}function b(c){try{a(o.throw(c))}catch(g){p(g)}}function a(c){c.done?d(c.value):h(c.value).then(v,b)}a((o=o.apply(r,n||[])).next())})};Object.defineProperty(y,"__esModule",{value:!0});y.getWsV4Endpoint=y.getHttpV4Endpoint=y.getHttpV4Endpoints=y.getHttpEndpoint=y.getHttpEndpoints=y.Access=void 0;var rt=S(),x=class{constructor(){this.host="ton.access.orbs.network",this.urlVersion=1,this.nodes=new rt.Nodes,this.package=q()}init(){return _(this,void 0,void 0,function*(){yield this.nodes.init(`https://${this.host}/mngr/nodes?npm_version=${this.package.version}`)})}makeProtonet(n,i){let o="";switch(n){case"toncenter-api-v2":o+="v2-";break;case"ton-api-v4":o+="v4-";break}return o+=i,o}weightedRandom(n){let i=0;for(let d of n)i+=d.Weight;let o=Math.floor(Math.random()*i),h=0;for(let d of n){if(o>=h&&o<h+d.Weight)return d;h+=d.Weight}}buildUrls(n,i,o,h,d){h||(h=""),o||(o="toncenter-api-v2"),i||(i="mainnet"),h.length&&(h=h.replace(/^\/+/,""));let p=[],v=this.makeProtonet(o,i),b=this.nodes.getHealthyFor(v);if(!(b!=null&&b.length))throw new Error(`no healthy nodes for ${v}`);if(d&&b.length){let a=this.weightedRandom(b);if(a)b=[a];else throw new Error("weightedRandom return empty")}for(let a of b){let c=`${n}://${this.host}/${a.NodeId}/${this.urlVersion}/${i}/${o}`;h.length&&(c+=`/${h}`),p.push(c)}return p}};y.Access=x;function $(r,n,i,o,h){return _(this,void 0,void 0,function*(){let d=new x;return yield d.init(),d.buildUrls(r,n,i,o,h)})}function C(r,n){return _(this,void 0,void 0,function*(){let i=r!=null&&r.network?r.network:"mainnet",o=r!=null&&r.scheme?r.scheme:"https",h="jsonRPC";return(r==null?void 0:r.protocol)==="rest"&&(h=""),yield $(o,i,"toncenter-api-v2",h,n)})}y.getHttpEndpoints=C;function nt(r){return _(this,void 0,void 0,function*(){return(yield C(r,!0))[0]})}y.getHttpEndpoint=nt;function R(r,n){return _(this,void 0,void 0,function*(){let i=r!=null&&r.network?r.network:"mainnet",o=r!=null&&r.scheme?r.scheme:"https";if((r==null?void 0:r.protocol)==="json-rpc")throw Error("config.protocol json-rpc is not supported for getTonApiV4Endpoints");return yield $(o,i,"ton-api-v4","",n)})}y.getHttpV4Endpoints=R;function it(r){return _(this,void 0,void 0,function*(){return(yield R(r,!0))[0]})}y.getHttpV4Endpoint=it;function ot(r){return _(this,void 0,void 0,function*(){return(yield R(r,!0))[0]})}y.getWsV4Endpoint=ot});var st=A(N=>{Object.defineProperty(N,"__esModule",{value:!0});var D=L();window.TonAccess={create:()=>new D.Access,getHttpEndpoint:D.getHttpEndpoint,getHttpV4Endpoint:D.getHttpV4Endpoint,getWsV4Endpoint:D.getWsV4Endpoint}});st();})();
